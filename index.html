<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz √âcologie</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #e0f7e9;
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      min-height: 100vh;
      color: #2a3d2d;
    }
    h1 {
      margin-top: 20px;
      font-weight: 700;
      text-align: center;
      color: #236f3e;
    }
    #menu, #quiz-container, #result-container {
      max-width: 600px;
      width: 90%;
      background: #f5fff9;
      border-radius: 10px;
      padding: 20px 25px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin: 20px auto;
    }
    select, button {
      padding: 10px 15px;
      margin: 10px 5px 20px 0;
      font-size: 1rem;
      border-radius: 6px;
      border: 2px solid #4caf50;
      background: #c7f1d1;
      color: #2a3d2d;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover:not(:disabled), select:hover {
      background: #98d99f;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    #answers button {
      display: block;
      width: 100%;
      margin: 8px 0;
      text-align: left;
      font-weight: 600;
    }
    .correct {
      background-color: #a1d99b !important;
      border-color: #4caf50 !important;
      color: #1b3816 !important;
    }
    .incorrect {
      background-color: #f28b82 !important;
      border-color: #d32f2f !important;
      color: #5a1a1a !important;
    }
    #timer {
      font-weight: 700;
      margin-bottom: 15px;
      color: #236f3e;
    }
    #timer-bar {
      width: 100%;
      height: 10px;
      background: #a9d5a7;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    #timer-progress {
      height: 100%;
      background: #4caf50;
      width: 100%;
      transition: width 1s linear;
    }
    .hidden {
      display: none;
    }
    #theme {
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 1.1rem;
      color: #317a33;
    }
    #next-btn, #back-to-menu-btn, #back-to-menu-during-quiz-btn {
      background: #4caf50;
      border-color: #3e8e41;
      color: #e9f9e9;
      font-weight: 700;
      margin-top: 15px;
    }
    #next-btn.hidden, #back-to-menu-during-quiz-btn.hidden {
      display: none;
    }
    #result-text {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
    }
    #citation {
      font-style: italic;
      color: #3e8e41;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Quiz √âcologie</h1>
  <div id="menu">
    <label for="mode-select">Choisissez le mode :</label>
    <select id="mode-select">
      <option value="normal" selected>Normal</option>
      <option value="battle">Battle</option>
    </select>
    <br />
    <label for="theme-select">Choisissez la th√©matique :</label>
    <select id="theme-select">
      <option value="" selected disabled>-- S√©lectionnez --</option>
      <option value="aleatoire">Al√©atoire</option>
      <option value="üåä Oc√©an">üåä Oc√©an</option>
      <option value="üå§Ô∏è Climat">üå§Ô∏è Climat</option>
      <option value="üå± Biodiversit√©">üå± Biodiversit√©</option>
      <option value="‚ôªÔ∏è Impacts sur Wallis et Futuna">‚ôªÔ∏è Impacts sur Wallis et Futuna</option>
      <option value="‚ö° √ânergie">‚ö° √ânergie</option>
      <option value="üóëÔ∏è D√©chets">üóëÔ∏è D√©chets</option>
    </select>
    <br />
    <button id="start-btn">D√©marrer le quiz</button>
  </div>

  <div id="quiz-container" class="hidden">
    <div id="theme"></div>
    <div id="question"></div>
    <div id="answers"></div>
    <div id="timer"></div>
    <div id="timer-bar"><div id="timer-progress"></div></div>
    <button id="next-btn" class="hidden">Suivant</button>
    <button id="back-to-menu-during-quiz-btn">Retour au menu</button>
  </div>

  <div id="result-container" class="hidden">
    <div id="result-text"></div>
    <div id="citation"></div>
    <button id="back-to-menu-btn">Retour au menu</button>
  </div>

  <script>
    const questions = [
      {theme:"üåä Oc√©an",question:"üåä Oc√©an ‚Äî Question 1 : Quelle est la principale cause de la pollution marine ?",choices:["Rejets industriels","Pollution par pesticides et engrais","Tourisme","P√™che intensive"],answer:"Pollution par pesticides et engrais"},
      {theme:"üå§Ô∏è Climat",question:"üå§Ô∏è Climat ‚Äî Question 1 : Qu‚Äôest-ce que le r√©chauffement climatique ?",choices:["Une p√©riode de froid intense","L‚Äôaugmentation moyenne des temp√©ratures sur Terre","Une nouvelle √®re glaciaire","Un ph√©nom√®ne naturel sans influence humaine"],answer:"L‚Äôaugmentation moyenne des temp√©ratures sur Terre"},
      {theme:"üå§Ô∏è Climat",question:"üå§Ô∏è Climat ‚Äî Question 2 : Quel gaz est principalement responsable de l‚Äôeffet de serre ?",choices:["Oxyg√®ne","Dioxyde de carbone","Azote","H√©lium"],answer:"Dioxyde de carbone"},
      {theme:"üå§Ô∏è Climat",question:"üå§Ô∏è Climat ‚Äî Question 3 : Quel secteur est le plus gros √©metteur de gaz √† effet de serre ?",choices:["Transport","Agriculture","Industrie","√ânergie"],answer:"√ânergie"},
      {theme:"üå± Biodiversit√©",question:"üå± Biodiversit√© ‚Äî Question 4 : Pourquoi la biodiversit√© est-elle importante ?",choices:["Pour le plaisir visuel","Pour l‚Äô√©quilibre des √©cosyst√®mes","Parce que c‚Äôest obligatoire","Pour produire plus de d√©chets"],answer:"Pour l‚Äô√©quilibre des √©cosyst√®mes"},
      {theme:"üå± Biodiversit√©",question:"üå± Biodiversit√© ‚Äî Question 5 : Quelle est la principale cause de la perte de biodiversit√© ?",choices:["Pollution","Changements climatiques","Destruction des habitats","Surpopulation humaine"],answer:"Destruction des habitats"},
      {theme:"üå± Biodiversit√©",question:"üå± Biodiversit√© ‚Äî Question 6 : Quel est l‚Äôeffet de l‚Äôintroduction d‚Äôesp√®ces invasives ?",choices:["Augmentation de la biodiversit√© locale","D√©s√©quilibre √©cologique","Meilleure qualit√© de l‚Äôair","R√©duction des risques naturels"],answer:"D√©s√©quilibre √©cologique"},
      {theme:"‚ôªÔ∏è Impacts sur Wallis et Futuna",question:"‚ôªÔ∏è Impacts sur Wallis et Futuna ‚Äî Question 7 : Quelle est la principale menace environnementale locale ?",choices:["Pollution plastique","D√©forestation","√ârosion c√¥ti√®re","Surp√™che"],answer:"√ârosion c√¥ti√®re"},
      {theme:"‚ôªÔ∏è Impacts sur Wallis et Futuna",question:"‚ôªÔ∏è Impacts sur Wallis et Futuna ‚Äî Question 8 : Quelle √©nergie est la plus utilis√©e sur l‚Äôarchipel ?",choices:["Solaire","Charbon","Fioul","Hydraulique"],answer:"Fioul"},
      {theme:"‚ôªÔ∏è Impacts sur Wallis et Futuna",question:"‚ôªÔ∏è Impacts sur Wallis et Futuna ‚Äî Question 9 : Quelle action locale aide √† prot√©ger l‚Äôenvironnement ?",choices:["Reboisement","Augmentation du plastique","Construction de nouvelles routes","Chasse intensive"],answer:"Reboisement"},
      {theme:"‚ö° √ânergie",question:"‚ö° √ânergie ‚Äî Question 10 : Quelle source d‚Äô√©nergie est renouvelable ?",choices:["P√©trole","Charbon","√âolienne","Gaz naturel"],answer:"√âolienne"},
      {theme:"‚ö° √ânergie",question:"‚ö° √ânergie ‚Äî Question 11 : Quel est l‚Äôimpact principal des √©nergies fossiles ?",choices:["Pollution de l‚Äôair","R√©chauffement climatique","Augmentation de la biodiversit√©","Ressources infinies"],answer:"R√©chauffement climatique"},
      {theme:"‚ö° √ânergie",question:"‚ö° √ânergie ‚Äî Question 12 : Quelle √©nergie produit le plus de CO2 ?",choices:["Nucl√©aire","Charbon","Solaire","Hydraulique"],answer:"Charbon"},
      {theme:"üóëÔ∏è D√©chets",question:"üóëÔ∏è D√©chets ‚Äî Question 16 : Quel est le principal probl√®me des d√©chets plastiques ?",choices:["Ils se d√©composent rapidement","Ils polluent les oc√©ans","Ils enrichissent le sol","Ils sont biod√©gradables"],answer:"Ils polluent les oc√©ans"},
      {theme:"üóëÔ∏è D√©chets",question:"üóëÔ∏è D√©chets ‚Äî Question 17 : Quelle solution r√©duit la production de d√©chets ?",choices:["Recycler","R√©utiliser","R√©duire","Tout ce qui pr√©c√®de"],answer:"Tout ce qui pr√©c√®de"},
      {theme:"üóëÔ∏è D√©chets",question:"üóëÔ∏è D√©chets ‚Äî Question 18 : Qu‚Äôest-ce que le compostage ?",choices:["Br√ªler les d√©chets","Transformer les d√©chets organiques en terreau","Jeter les d√©chets dans la nature","R√©utiliser les d√©chets plastiques"],answer:"Transformer les d√©chets organiques en terreau"}
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let selectedMode = "normal";
    let selectedTheme = "";
    let timerInterval = null;
    let timePerQuestion = 15;
    let timeLeft = timePerQuestion;

    const menu = document.getElementById('menu');
    const quizContainer = document.getElementById('quiz-container');
    const resultContainer = document.getElementById('result-container');
    const themeDisplay = document.getElementById('theme');
    const questionEl = document.getElementById('question');
    const answersEl = document.getElementById('answers');
    const timerEl = document.getElementById('timer');
    const timerBar = document.getElementById('timer-progress');
    const nextBtn = document.getElementById('next-btn');
    const backToMenuDuringQuizBtn = document.getElementById('back-to-menu-during-quiz-btn');
    const backToMenuBtn = document.getElementById('back-to-menu-btn');
    const modeSelect = document.getElementById('mode-select');
    const themeSelect = document.getElementById('theme-select');
    const startBtn = document.getElementById('start-btn');

    startBtn.addEventListener('click', startQuiz);
    nextBtn.addEventListener('click', () => {
      currentQuestionIndex++;
      if (currentQuestionIndex < filteredQuestions.length) {
        setNextQuestion();
      } else {
        endQuiz();
      }
    });
    backToMenuBtn.addEventListener('click', resetQuiz);
    backToMenuDuringQuizBtn.addEventListener('click', resetQuiz);
    modeSelect.addEventListener('change', e => { selectedMode = e.target.value; });
    themeSelect.addEventListener('change', e => { selectedTheme = e.target.value; });

    let filteredQuestions = [];

    function startQuiz() {
      if (selectedTheme === "") {
        alert("Veuillez choisir une th√©matique.");
        return;
      }
      menu.classList.add('hidden');
      resultContainer.classList.add('hidden');
      quizContainer.classList.remove('hidden');
      backToMenuDuringQuizBtn.classList.remove('hidden');
      currentQuestionIndex = 0;
      score = 0;
      if (selectedTheme === "aleatoire") {
        filteredQuestions = [...questions].sort(() => Math.random() - 0.5);
      } else {
        filteredQuestions = questions.filter(q => q.theme === selectedTheme);
      }
      setNextQuestion();
    }

    function setNextQuestion() {
      resetState();
      showQuestion(filteredQuestions[currentQuestionIndex]);
      startTimer();
    }

    function showQuestion(questionObj) {
      themeDisplay.textContent = questionObj.theme;
      questionEl.textContent = questionObj.question;
      answersEl.innerHTML = '';
      questionObj.choices.forEach(choice => {
        const button = document.createElement('button');
        button.textContent = choice;
        button.addEventListener('click', () => selectAnswer(button, questionObj.answer));
        answersEl.appendChild(button);
      });
    }

    function resetState() {
      clearStatusClass(document.body);
      nextBtn.classList.add('hidden');
      while (answersEl.firstChild) {
        answersEl.removeChild(answersEl.firstChild);
      }
      clearInterval(timerInterval);
      timeLeft = timePerQuestion;
      updateTimerUI();
    }

    function selectAnswer(selectedButton, correctAnswer) {
      clearInterval(timerInterval);
      const buttons = answersEl.querySelectorAll('button');
      buttons.forEach(button => {
        setStatusClass(button, button.textContent === correctAnswer);
        button.disabled = true;
      });
      if (selectedButton.textContent === correctAnswer) {
        score++;
      }
      nextBtn.classList.remove('hidden');
      if (selectedMode === 'battle') {
        nextBtn.textContent = "Suivant";
      } else {
        setTimeout(() => {
          currentQuestionIndex++;
          if (currentQuestionIndex < filteredQuestions.length) {
            setNextQuestion();
          } else {
            endQuiz();
          }
        }, 1500);
      }
    }

    function setStatusClass(element, correct) {
      clearStatusClass(element);
      if (correct) {
        element.classList.add('correct');
      } else {
        element.classList.add('incorrect');
      }
    }

    function clearStatusClass(element) {
      element.classList.remove('correct');
      element.classList.remove('incorrect');
    }

    function startTimer() {
      timeLeft = timePerQuestion;
      updateTimerUI();
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerUI();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          const correctAnswer = filteredQuestions[currentQuestionIndex].answer;
          const buttons = answersEl.querySelectorAll('button');
          buttons.forEach(button => {
            if (button.textContent === correctAnswer) {
              setStatusClass(button, true);
            }
            button.disabled = true;
          });
          nextBtn.classList.remove('hidden');
        }
      }, 1000);
    }

    function updateTimerUI() {
      timerEl.textContent = `Temps restant : ${timeLeft}s`;
      const percentage = (timeLeft / timePerQuestion) * 100;
      timerBar.style.width = percentage + '%';
    }

    function endQuiz() {
      quizContainer.classList.add('hidden');
      backToMenuDuringQuizBtn.classList.add('hidden');
      resultContainer.classList.remove('hidden');
      const total = filteredQuestions.length;
      const percent = Math.round((score / total) * 100);
      let message = "";
      if (percent === 100) {
        message = "Parfait ! Vous √™tes un.e expert.e de l‚Äô√©cologie ! üåø";
      } else if (percent >= 75) {
        message = "Bravo, tr√®s bon score ! üçÄ";
      } else if (percent >= 50) {
        message = "Pas mal, mais vous pouvez faire mieux ! üå±";
      } else {
        message = "Il faut r√©viser un peu plus l‚Äô√©cologie ! üåé";
      }
      document.getElementById('result-text').textContent = `Vous avez obtenu ${score} bonnes r√©ponses sur ${total} (${percent}%). ${message}`;
      document.getElementById('citation').textContent = '‚ÄúLa Terre ne nous appartient pas, nous l‚Äôempruntons √† nos enfants.‚Äù ‚Äì Antoine de Saint-Exup√©ry';
    }

    function resetQuiz() {
      clearInterval(timerInterval);
      quizContainer.classList.add('hidden');
      resultContainer.classList.add('hidden');
      menu.classList.remove('hidden');
      backToMenuDuringQuizBtn.classList.add('hidden');
      nextBtn.classList.add('hidden');
      score = 0;
      currentQuestionIndex = 0;
      timerEl.textContent = '';
      timerBar.style.width = '100%';
    }
  </script>
</body>
</html>
