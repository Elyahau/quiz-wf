<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quiz Écologie</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #e0f7e9;
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      min-height: 100vh;
      color: #2a3d2d;
    }
    h1 {
      margin-top: 20px;
      font-weight: 700;
      text-align: center;
      color: #236f3e;
    }
    #menu, #quiz-container, #result-container {
      max-width: 600px;
      width: 90%;
      background: #f5fff9;
      border-radius: 10px;
      padding: 20px 25px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin: 20px auto;
    }
    select, button {
      padding: 10px 15px;
      margin: 10px 5px 20px 0;
      font-size: 1rem;
      border-radius: 6px;
      border: 2px solid #4caf50;
      background: #c7f1d1;
      color: #2a3d2d;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover:not(:disabled), select:hover {
      background: #98d99f;
    }
    button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }
    #answers button {
      display: block;
      width: 100%;
      margin: 8px 0;
      text-align: left;
      font-weight: 600;
    }
    .correct {
      background-color: #a1d99b !important;
      border-color: #4caf50 !important;
      color: #1b3816 !important;
    }
    .incorrect {
      background-color: #f28b82 !important;
      border-color: #d32f2f !important;
      color: #5a1a1a !important;
    }
    #timer {
      font-weight: 700;
      margin-bottom: 15px;
      color: #236f3e;
    }
    #timer-bar {
      width: 100%;
      height: 10px;
      background: #a9d5a7;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    #timer-progress {
      height: 100%;
      background: #4caf50;
      width: 100%;
      transition: width 1s linear;
    }
    .hidden {
      display: none;
    }
    #theme {
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 1.1rem;
      color: #317a33;
    }
    #next-btn, #back-to-menu-btn, #back-to-menu-during-quiz-btn {
      background: #4caf50;
      border-color: #3e8e41;
      color: #e9f9e9;
      font-weight: 700;
      margin-top: 15px;
    }
    #next-btn.hidden, #back-to-menu-during-quiz-btn.hidden {
      display: none;
    }
    #result-text {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
    }
    #citation {
      font-style: italic;
      color: #3e8e41;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Quiz Écologie</h1>
  <div id="menu">
    <label for="mode-select">Choisissez le mode :</label>
    <select id="mode-select">
      <option value="normal" selected>Normal</option>
      <option value="battle">Battle</option>
    </select>
    <br />
    <label for="theme-select">Choisissez la thématique :</label>
    <select id="theme-select">
      <option value="" selected disabled>-- Sélectionnez --</option>
      <option value="aleatoire">Aléatoire</option>
      <option value="🌊 Océan">🌊 Océan</option>
      <option value="🌤️ Climat">🌤️ Climat</option>
      <option value="🌱 Biodiversité">🌱 Biodiversité</option>
      <option value="♻️ Impacts sur Wallis et Futuna">♻️ Impacts sur Wallis et Futuna</option>
      <option value="⚡ Énergie">⚡ Énergie</option>
      <option value="🗑️ Déchets">🗑️ Déchets</option>
    </select>
    <br />
    <button id="start-btn">Démarrer le quiz</button>
  </div>

  <div id="quiz-container" class="hidden">
    <div id="theme"></div>
    <div id="question"></div>
    <div id="answers"></div>
    <div id="timer"></div>
    <div id="timer-bar"><div id="timer-progress"></div></div>
    <button id="next-btn" class="hidden">Suivant</button>
    <button id="back-to-menu-during-quiz-btn">Retour au menu</button>
  </div>

  <div id="result-container" class="hidden">
    <div id="result-text"></div>
    <div id="citation"></div>
    <button id="back-to-menu-btn">Retour au menu</button>
  </div>

  <script>
    const questions = [
      {theme:"🌊 Océan",question:"🌊 Océan — Question 1 : Quelle est la principale cause de la pollution marine ?",choices:["Rejets industriels","Pollution par pesticides et engrais","Tourisme","Pêche intensive"],answer:"Pollution par pesticides et engrais"},
      {theme:"🌤️ Climat",question:"🌤️ Climat — Question 1 : Qu’est-ce que le réchauffement climatique ?",choices:["Une période de froid intense","L’augmentation moyenne des températures sur Terre","Une nouvelle ère glaciaire","Un phénomène naturel sans influence humaine"],answer:"L’augmentation moyenne des températures sur Terre"},
      {theme:"🌤️ Climat",question:"🌤️ Climat — Question 2 : Quel gaz est principalement responsable de l’effet de serre ?",choices:["Oxygène","Dioxyde de carbone","Azote","Hélium"],answer:"Dioxyde de carbone"},
      {theme:"🌤️ Climat",question:"🌤️ Climat — Question 3 : Quel secteur est le plus gros émetteur de gaz à effet de serre ?",choices:["Transport","Agriculture","Industrie","Énergie"],answer:"Énergie"},
      {theme:"🌱 Biodiversité",question:"🌱 Biodiversité — Question 4 : Pourquoi la biodiversité est-elle importante ?",choices:["Pour le plaisir visuel","Pour l’équilibre des écosystèmes","Parce que c’est obligatoire","Pour produire plus de déchets"],answer:"Pour l’équilibre des écosystèmes"},
      {theme:"🌱 Biodiversité",question:"🌱 Biodiversité — Question 5 : Quelle est la principale cause de la perte de biodiversité ?",choices:["Pollution","Changements climatiques","Destruction des habitats","Surpopulation humaine"],answer:"Destruction des habitats"},
      {theme:"🌱 Biodiversité",question:"🌱 Biodiversité — Question 6 : Quel est l’effet de l’introduction d’espèces invasives ?",choices:["Augmentation de la biodiversité locale","Déséquilibre écologique","Meilleure qualité de l’air","Réduction des risques naturels"],answer:"Déséquilibre écologique"},
      {theme:"♻️ Impacts sur Wallis et Futuna",question:"♻️ Impacts sur Wallis et Futuna — Question 7 : Quelle est la principale menace environnementale locale ?",choices:["Pollution plastique","Déforestation","Érosion côtière","Surpêche"],answer:"Érosion côtière"},
      {theme:"♻️ Impacts sur Wallis et Futuna",question:"♻️ Impacts sur Wallis et Futuna — Question 8 : Quelle énergie est la plus utilisée sur l’archipel ?",choices:["Solaire","Charbon","Fioul","Hydraulique"],answer:"Fioul"},
      {theme:"♻️ Impacts sur Wallis et Futuna",question:"♻️ Impacts sur Wallis et Futuna — Question 9 : Quelle action locale aide à protéger l’environnement ?",choices:["Reboisement","Augmentation du plastique","Construction de nouvelles routes","Chasse intensive"],answer:"Reboisement"},
      {theme:"⚡ Énergie",question:"⚡ Énergie — Question 10 : Quelle source d’énergie est renouvelable ?",choices:["Pétrole","Charbon","Éolienne","Gaz naturel"],answer:"Éolienne"},
      {theme:"⚡ Énergie",question:"⚡ Énergie — Question 11 : Quel est l’impact principal des énergies fossiles ?",choices:["Pollution de l’air","Réchauffement climatique","Augmentation de la biodiversité","Ressources infinies"],answer:"Réchauffement climatique"},
      {theme:"⚡ Énergie",question:"⚡ Énergie — Question 12 : Quelle énergie produit le plus de CO2 ?",choices:["Nucléaire","Charbon","Solaire","Hydraulique"],answer:"Charbon"},
      {theme:"🗑️ Déchets",question:"🗑️ Déchets — Question 16 : Quel est le principal problème des déchets plastiques ?",choices:["Ils se décomposent rapidement","Ils polluent les océans","Ils enrichissent le sol","Ils sont biodégradables"],answer:"Ils polluent les océans"},
      {theme:"🗑️ Déchets",question:"🗑️ Déchets — Question 17 : Quelle solution réduit la production de déchets ?",choices:["Recycler","Réutiliser","Réduire","Tout ce qui précède"],answer:"Tout ce qui précède"},
      {theme:"🗑️ Déchets",question:"🗑️ Déchets — Question 18 : Qu’est-ce que le compostage ?",choices:["Brûler les déchets","Transformer les déchets organiques en terreau","Jeter les déchets dans la nature","Réutiliser les déchets plastiques"],answer:"Transformer les déchets organiques en terreau"}
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let selectedMode = "normal";
    let selectedTheme = "";
    let timerInterval = null;
    let timePerQuestion = 15;
    let timeLeft = timePerQuestion;

    const menu = document.getElementById('menu');
    const quizContainer = document.getElementById('quiz-container');
    const resultContainer = document.getElementById('result-container');
    const themeDisplay = document.getElementById('theme');
    const questionEl = document.getElementById('question');
    const answersEl = document.getElementById('answers');
    const timerEl = document.getElementById('timer');
    const timerBar = document.getElementById('timer-progress');
    const nextBtn = document.getElementById('next-btn');
    const backToMenuDuringQuizBtn = document.getElementById('back-to-menu-during-quiz-btn');
    const backToMenuBtn = document.getElementById('back-to-menu-btn');
    const modeSelect = document.getElementById('mode-select');
    const themeSelect = document.getElementById('theme-select');
    const startBtn = document.getElementById('start-btn');

    startBtn.addEventListener('click', startQuiz);
    nextBtn.addEventListener('click', () => {
      currentQuestionIndex++;
      if (currentQuestionIndex < filteredQuestions.length) {
        setNextQuestion();
      } else {
        endQuiz();
      }
    });
    backToMenuBtn.addEventListener('click', resetQuiz);
    backToMenuDuringQuizBtn.addEventListener('click', resetQuiz);
    modeSelect.addEventListener('change', e => { selectedMode = e.target.value; });
    themeSelect.addEventListener('change', e => { selectedTheme = e.target.value; });

    let filteredQuestions = [];

    function startQuiz() {
      if (selectedTheme === "") {
        alert("Veuillez choisir une thématique.");
        return;
      }
      menu.classList.add('hidden');
      resultContainer.classList.add('hidden');
      quizContainer.classList.remove('hidden');
      backToMenuDuringQuizBtn.classList.remove('hidden');
      currentQuestionIndex = 0;
      score = 0;
      if (selectedTheme === "aleatoire") {
        filteredQuestions = [...questions].sort(() => Math.random() - 0.5);
      } else {
        filteredQuestions = questions.filter(q => q.theme === selectedTheme);
      }
      setNextQuestion();
    }

    function setNextQuestion() {
      resetState();
      showQuestion(filteredQuestions[currentQuestionIndex]);
      startTimer();
    }

    function showQuestion(questionObj) {
      themeDisplay.textContent = questionObj.theme;
      questionEl.textContent = questionObj.question;
      answersEl.innerHTML = '';
      questionObj.choices.forEach(choice => {
        const button = document.createElement('button');
        button.textContent = choice;
        button.addEventListener('click', () => selectAnswer(button, questionObj.answer));
        answersEl.appendChild(button);
      });
    }

    function resetState() {
      clearStatusClass(document.body);
      nextBtn.classList.add('hidden');
      while (answersEl.firstChild) {
        answersEl.removeChild(answersEl.firstChild);
      }
      clearInterval(timerInterval);
      timeLeft = timePerQuestion;
      updateTimerUI();
    }

    function selectAnswer(selectedButton, correctAnswer) {
      clearInterval(timerInterval);
      const buttons = answersEl.querySelectorAll('button');
      buttons.forEach(button => {
        setStatusClass(button, button.textContent === correctAnswer);
        button.disabled = true;
      });
      if (selectedButton.textContent === correctAnswer) {
        score++;
      }
      nextBtn.classList.remove('hidden');
      if (selectedMode === 'battle') {
        nextBtn.textContent = "Suivant";
      } else {
        setTimeout(() => {
          currentQuestionIndex++;
          if (currentQuestionIndex < filteredQuestions.length) {
            setNextQuestion();
          } else {
            endQuiz();
          }
        }, 1500);
      }
    }

    function setStatusClass(element, correct) {
      clearStatusClass(element);
      if (correct) {
        element.classList.add('correct');
      } else {
        element.classList.add('incorrect');
      }
    }

    function clearStatusClass(element) {
      element.classList.remove('correct');
      element.classList.remove('incorrect');
    }

    function startTimer() {
      timeLeft = timePerQuestion;
      updateTimerUI();
      timerInterval = setInterval(() => {
        timeLeft--;
        updateTimerUI();
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          const correctAnswer = filteredQuestions[currentQuestionIndex].answer;
          const buttons = answersEl.querySelectorAll('button');
          buttons.forEach(button => {
            if (button.textContent === correctAnswer) {
              setStatusClass(button, true);
            }
            button.disabled = true;
          });
          nextBtn.classList.remove('hidden');
        }
      }, 1000);
    }

    function updateTimerUI() {
      timerEl.textContent = `Temps restant : ${timeLeft}s`;
      const percentage = (timeLeft / timePerQuestion) * 100;
      timerBar.style.width = percentage + '%';
    }

    function endQuiz() {
      quizContainer.classList.add('hidden');
      backToMenuDuringQuizBtn.classList.add('hidden');
      resultContainer.classList.remove('hidden');
      const total = filteredQuestions.length;
      const percent = Math.round((score / total) * 100);
      let message = "";
      if (percent === 100) {
        message = "Parfait ! Vous êtes un.e expert.e de l’écologie ! 🌿";
      } else if (percent >= 75) {
        message = "Bravo, très bon score ! 🍀";
      } else if (percent >= 50) {
        message = "Pas mal, mais vous pouvez faire mieux ! 🌱";
      } else {
        message = "Il faut réviser un peu plus l’écologie ! 🌎";
      }
      document.getElementById('result-text').textContent = `Vous avez obtenu ${score} bonnes réponses sur ${total} (${percent}%). ${message}`;
      document.getElementById('citation').textContent = '“La Terre ne nous appartient pas, nous l’empruntons à nos enfants.” – Antoine de Saint-Exupéry';
    }

    function resetQuiz() {
      clearInterval(timerInterval);
      quizContainer.classList.add('hidden');
      resultContainer.classList.add('hidden');
      menu.classList.remove('hidden');
      backToMenuDuringQuizBtn.classList.add('hidden');
      nextBtn.classList.add('hidden');
      score = 0;
      currentQuestionIndex = 0;
      timerEl.textContent = '';
      timerBar.style.width = '100%';
    }
  </script>
</body>
</html>
